<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chunked Request Example</title>
  </head>
  <body>
    <h1>Chunked Request Example</h1>
    <button onclick="sendChunkedRequest()">Send Chunked Request</button>

    <script>
      async function sendChunkedRequest() {
        const url = "http://localhost:8082/cgi-bin/chunked.py";

        // Prepare chunked data in a readable stream
        const bodyStream = new ReadableStream({
          start(controller) {
            // Send chunks one at a time
            controller.enqueue(new TextEncoder().encode("Hello, "));
            controller.enqueue(new TextEncoder().encode("this is "));
            controller.enqueue(new TextEncoder().encode("a test."));
            controller.close(); // Signal the end of the stream
          },
        });

        // Send request with chunked transfer encoding
        const response = await fetch(url, {
          method: "POST",
          headers: {
            "Transfer-Encoding": "chunked",
            "Content-Type": "text/plain",
          },
          body: bodyStream,
        });

        // Output the response
        const responseBody = await response.text();
        console.log("Server response:", responseBody);
      }
    </script>
  </body>
</html>
